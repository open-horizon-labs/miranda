{"id":"kv-0iss","title":"Add HTTP server for hook notifications - receive POST from Claude's PreToolUse hook on /notify endpoint","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:15:37.504468Z","updated_at":"2026-01-05T10:38:51.107176Z","closed_at":"2026-01-05T10:38:51.107176Z","blocks":[],"blocked_by":[]}
{"id":"kv-0nas","title":"Implement state/sessions.ts - Map-based session store with getSession, setSession, deleteSession, getAllSessions, findSessionByTmuxName, findSessionAwaitingInput","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:39:08.609470Z","updated_at":"2026-01-05T10:44:12.758212Z","closed_at":"2026-01-05T10:44:12.758212Z","blocks":["kv-duia","kv-jncb"],"blocked_by":[]}
{"id":"kv-105n","title":"Add /restart command - graceful Miranda restart","description":"Exit process gracefully so systemd/PM2 restarts with new code. Send confirmation message before exit. Optionally store chat ID to send 'back online' message on startup.","status":"in_progress","priority":2,"issue_type":"task","session_id":"2161762","labels":[],"comments":[{"author":"anonymous","text":"Graceful shutdown needs: (1) bot.stop() to stop grammY polling, (2) close HTTP hook server, (3) warn user that in-memory session state will be lost but tmux sessions persist, (4) suggest running /cleanup after restart to re-sync orphaned sessions. Consider adding SIGTERM/SIGINT handlers that do the same cleanup.","created_at":"2026-01-08T14:14:28.322222Z"},{"author":"anonymous","text":"Alternative to /cleanup after restart: auto-discover orphaned tmux sessions on startup and re-populate sessions map. Look for mouse-*/drummer-*/notes-* tmux sessions and create Session objects for them with status='unknown'. Then /status will show them.","created_at":"2026-01-08T14:14:39.875861Z"}],"created_at":"2026-01-08T14:13:13.515397Z","updated_at":"2026-01-08T18:35:11.201889183Z","blocks":[],"blocked_by":["kv-atoo"]}
{"id":"kv-29k7","title":"Server setup: Copy mouse/drummer skills to Hetzner ~/.claude/skills/","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:19:35.333042Z","updated_at":"2026-01-05T12:48:10.480294Z","closed_at":"2026-01-05T12:48:10.480294Z","blocks":[],"blocked_by":[]}
{"id":"kv-33ej","title":"Auto-cleanup tmux session on completion signal - kill session after /complete received","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"In handleCompletion (index.ts), after sending Telegram notification:\n\n1. Get tmuxName from session\n2. Call killSession(tmuxName) to terminate the tmux session\n3. Session state already cleaned up by deleteSession()\n\nCurrently completion just notifies + deletes state, leaving orphaned tmux session.","created_at":"2026-01-06T00:09:34.330138Z"}],"created_at":"2026-01-06T00:09:28.518121Z","updated_at":"2026-01-06T00:15:49.945176690Z","closed_at":"2026-01-06T00:15:49.945176690Z","blocks":[],"blocked_by":[]}
{"id":"kv-37j7","title":"Implement /status command - list active tmux sessions with their state","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:16:00.689033Z","updated_at":"2026-01-05T10:38:51.122826Z","closed_at":"2026-01-05T10:38:51.122826Z","blocks":[],"blocked_by":[]}
{"id":"kv-3gax","title":"Add /projects command - list projects in PROJECTS_DIR with task counts, inline buttons to view tasks","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Scan PROJECTS_DIR (env var, default ~/projects) for dirs with .ba/issues.jsonl. Show project name + open/in_progress counts. Inline keyboard buttons → /tasks <project>","created_at":"2026-01-05T16:09:11.342366Z"}],"created_at":"2026-01-05T16:08:50.650661Z","updated_at":"2026-01-05T22:57:09.216261231Z","closed_at":"2026-01-05T22:57:09.216261231Z","blocks":[],"blocked_by":[]}
{"id":"kv-499a","title":"Extract task keyboard builder - dedupe handleTasks and handleTasksCallback","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Both handleTasks() and handleTasksCallback() build identical inline keyboards with task formatting logic. Extract to helper:\n\n```typescript\nfunction buildTaskKeyboard(tasks: BaTask[], projectName: string): {\n  message: string;\n  keyboard: InlineKeyboard;\n}\n```\n\nReturns formatted message + keyboard. Both handlers call this helper.","created_at":"2026-01-06T00:15:15.000135Z"}],"created_at":"2026-01-06T00:15:09.527217Z","updated_at":"2026-01-06T00:26:53.053912816Z","closed_at":"2026-01-06T00:26:53.053912816Z","blocks":[],"blocked_by":[]}
{"id":"kv-4cn6","title":"Update skills to use full path for sg (~/.cargo/bin/sg) to avoid ast-grep conflict","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"On servers with ast-grep installed, 'sg' resolves to wrong binary. Update mouse, drummer, notes skills to use ~/.cargo/bin/sg or $HOME/.cargo/bin/sg for all sg init, sg review calls. Bump plugin version.","created_at":"2026-01-05T18:20:25.962195Z"},{"author":"anonymous","text":"Alternative: source $HOME/.cargo/env in tmux spawn (sessions.ts) before running claude. Single fix, keeps ast-grep available, ensures all cargo-installed tools work. Change tmux command to: bash -c 'source $HOME/.cargo/env && claude ...'","created_at":"2026-01-05T18:22:52.985688Z"}],"created_at":"2026-01-05T18:20:20.447815Z","updated_at":"2026-01-05T18:25:51.254147Z","closed_at":"2026-01-05T18:25:51.254147Z","blocks":[],"blocked_by":[]}
{"id":"kv-5fcy","title":"Update systemd service to run as dedicated miranda user instead of root","description":"","status":"closed","priority":3,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T12:45:29.586871Z","updated_at":"2026-01-05T13:10:24.234871Z","closed_at":"2026-01-05T13:10:24.234871Z","blocks":[],"blocked_by":[]}
{"id":"kv-5pen","title":"Add project creation from Telegram - git clone and optional scaffolding","description":"","status":"closed","priority":3,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Related to /projects command. Flow: /newproject <repo-url> [--template <name>] → git clone → init ba → optional scaffold. Consider project registry for multi-project support.","created_at":"2026-01-05T11:50:56.290565Z"}],"created_at":"2026-01-05T11:50:24.822412Z","updated_at":"2026-01-05T16:09:28.552178Z","closed_at":"2026-01-05T16:09:28.552178Z","blocks":[],"blocked_by":[]}
{"id":"kv-658x","title":"Add /complete endpoint to Miranda - receive skill completion signals, cleanup session map, notify user","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"POST /complete receives {session, status, pr?, error?}. Lookup session by tmux name, delete from map, send Telegram notification (success with PR URL, or error with reason). Handle unknown sessions gracefully.","created_at":"2026-01-05T16:31:08.768251Z"}],"created_at":"2026-01-05T16:30:55.610113Z","updated_at":"2026-01-05T21:23:53.046206145Z","closed_at":"2026-01-05T16:48:49.473414193Z","blocks":["kv-o8q4","kv-qrkc"],"blocked_by":[]}
{"id":"kv-73n6","title":"Require explicit project for /notes command","description":"Change /notes to require project: /notes <project> <pr-number>. Validate project exists in PROJECTS_DIR, pass projectPath to spawnSession. Error if no project specified. Notes skill requires repo context for gh pr checkout.","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-08T14:22:51.058938Z","updated_at":"2026-01-08T17:38:54.047366Z","closed_at":"2026-01-08T15:01:38.007817313Z","blocks":["kv-zozr"],"blocked_by":[]}
{"id":"kv-79hj","title":"Set TMUX_SESSION env var when spawning tmux session for hook integration","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"In tmux/sessions.ts spawnSession(), add -e TMUX_SESSION=${tmuxName} to the tmux new-session command. This allows notify-miranda.sh hook to identify which session triggered AskUserQuestion.","created_at":"2026-01-05T11:23:38.211811Z"}],"created_at":"2026-01-05T11:22:09.883977Z","updated_at":"2026-01-05T11:27:27.134484Z","closed_at":"2026-01-05T11:27:27.134484Z","blocks":[],"blocked_by":[]}
{"id":"kv-8dxm","title":"Auto-update projects before task discovery","description":"Before /tasks or /mouse tries to find a task, pull latest from remote (git pull --ff-only on clean repos). Ensures task list reflects current state when working from phone. Reuse logic from /update command.","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-08T13:56:48.412986Z","updated_at":"2026-01-08T14:10:08.535278277Z","closed_at":"2026-01-08T14:10:08.535278277Z","blocks":[],"blocked_by":["kv-fhu7"]}
{"id":"kv-8qn4","title":"Server setup: Install Node.js, tmux, mosh on Hetzner","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:19:35.322907Z","updated_at":"2026-01-05T12:48:10.469793Z","closed_at":"2026-01-05T12:48:10.469793Z","blocks":[],"blocked_by":[]}
{"id":"kv-8r36","title":"Add /notes skill - address human PR comments, checkout branch, resolve feedback, push fixes","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Invocation: /notes <pr-number>. Flow: gh pr checkout, fetch comments (gh pr view --comments --json), work through unresolved human comments, sg review each fix, commit, push, signal completion. Theater canon - actors get notes from director to address.","created_at":"2026-01-05T16:49:28.253233Z"},{"author":"anonymous","text":"Also: create plugin/skills/notes/SKILL.md, bump plugin version in plugin.json and marketplace.json.","created_at":"2026-01-05T16:50:14.782656Z"},{"author":"anonymous","text":"Review loop same as mouse: for each comment fix, stage changes, sg review, handle findings (P1-P3 trivial: fix inline, P1-P3 non-trivial: ba create descendant, P4: discard). Complete all descendants before push. Signal completion with PR URL or blocked reason.","created_at":"2026-01-05T16:54:04.069426Z"}],"created_at":"2026-01-05T16:49:21.810562Z","updated_at":"2026-01-05T17:19:27.151840Z","closed_at":"2026-01-05T17:19:27.151840Z","blocks":["kv-qrkc","kv-yk15"],"blocked_by":[]}
{"id":"kv-af12","title":"Remove wm init from /newproject - too token hungry","description":"Remove wm init from cloneAndInit() in src/projects/clone.ts. wm is too token-hungry for remote bootstrap. Only init ba and sg. Update CLAUDE.md to reflect this change.","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-08T14:25:38.299266Z","updated_at":"2026-01-08T14:32:34.439519773Z","closed_at":"2026-01-08T14:32:34.439519773Z","blocks":[],"blocked_by":[]}
{"id":"kv-aj9x","title":"Include project name in mouse task notifications","description":"When /mouse starts a task, include the project name in the Telegram notification (e.g., 'miranda: kv-abc123' instead of just 'kv-abc123'). Helps context when managing multiple projects from phone.","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-08T12:21:57.217837Z","updated_at":"2026-01-08T17:45:19.870762487Z","closed_at":"2026-01-08T17:45:19.870762487Z","blocks":[],"blocked_by":[]}
{"id":"kv-atoo","title":"Add /selfupdate command - pull and rebuild Miranda","description":"Pull latest Miranda code and rebuild. Steps: git pull --ff-only, pnpm install, pnpm build. Report what changed (commits pulled). Requires MIRANDA_HOME env var or derive from __dirname. Does NOT restart - use /restart for that.","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-08T14:13:13.343265Z","updated_at":"2026-01-08T17:49:04.919411669Z","closed_at":"2026-01-08T17:49:04.919411669Z","blocks":["kv-105n"],"blocked_by":[]}
{"id":"kv-cggk","title":"Add body size limit to hook server (64KB max)","description":"","status":"closed","priority":3,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:50:33.697003Z","updated_at":"2026-01-05T10:50:39.713574Z","closed_at":"2026-01-05T10:50:39.713574Z","blocks":[],"blocked_by":[]}
{"id":"kv-craa","title":"Add completion signaling to drummer skill - curl /complete on success/error","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T17:02:32.374360Z","updated_at":"2026-01-05T22:58:13.469381907Z","closed_at":"2026-01-05T22:58:13.469381907Z","blocks":[],"blocked_by":[]}
{"id":"kv-cu1m","title":"Implement bot/keyboards.ts - buildQuestionKeyboard(taskId, questions), parseCallback(data), formatAnswer(action, questions)","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:39:08.625687Z","updated_at":"2026-01-05T11:28:29.416963Z","closed_at":"2026-01-05T11:28:29.416963Z","blocks":["kv-duia","kv-jncb"],"blocked_by":[]}
{"id":"kv-d90k","title":"Create notify-miranda.sh hook script for Claude Code PreToolUse","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:15:56.500734Z","updated_at":"2026-01-05T11:12:24.856540Z","closed_at":"2026-01-05T11:12:24.856540Z","blocks":[],"blocked_by":[]}
{"id":"kv-dkio","title":"Add /projects command - list projects on server with task counts","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:24:02.503834Z","updated_at":"2026-01-05T16:09:28.546684Z","closed_at":"2026-01-05T16:09:28.546684Z","blocks":[],"blocked_by":[]}
{"id":"kv-duia","title":"Implement bot/commands.ts - /mouse (spawn session), /status (list sessions), /stop (kill session), message:text handler for free text input","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:39:14.695966Z","updated_at":"2026-01-05T11:50:09.936672Z","closed_at":"2026-01-05T11:50:09.936672Z","blocks":["kv-jncb"],"blocked_by":["kv-0nas","kv-t4d1","kv-cu1m","kv-ui80"]}
{"id":"kv-f3ov","title":"Add /tasks <project> command - list tasks for a project with inline selection","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"## Implementation Spec\n\n### Entry Points\n1. **Callback from /projects**: `tasks:<project-name>` - user taps project button\n2. **Direct command**: `/tasks <project-name>` - user types command\n\n### Flow\n1. Look up project: `PROJECTS_DIR/<project-name>`\n2. Read `.ba/issues.jsonl`, parse tasks\n3. Filter to `open` + `in_progress` status only\n4. Display as inline keyboard:\n   ```\n   *Tasks for miranda*\n   \n   [kv-f3ov: Add /tasks command (open)]\n   [kv-j12y: Update /stop command (open)]\n   ```\n\n### Callback Data Design\n- Task buttons: `mouse:<project>:<task-id>`\n- Example: `mouse:miranda:kv-f3ov`\n- Need both project + task-id since mouse spawns in project dir\n\n### Files to Modify\n- `src/index.ts`: Add `tasks:` callback handler\n- `src/bot/commands.ts`: Add `/tasks` command + handleTasks\n- `src/projects/scanner.ts`: Add `getProjectTasks(name)` function\n\n### Notes\n- Callback data 64-byte limit - keep project:task-id short\n- Re-use scanProjects logic for validation\n- Mouse spawn needs project path, pass via env or update MIRANDA_DEFAULT_PROJECT","created_at":"2026-01-05T23:47:55.374194Z"},{"author":"anonymous","text":"## Additional: Multi-project dispatch\n\nCurrently `spawnSession` uses global `MIRANDA_DEFAULT_PROJECT`. Need to:\n\n1. **Update spawnSession signature**: Add optional `projectPath` parameter\n   ```typescript\n   export async function spawnSession(\n     skill: SkillType,\n     taskId: string | undefined,\n     chatId: number,\n     projectPath?: string  // NEW: override default project\n   ): Promise<string>\n   ```\n\n2. **Update tmux spawn**: Use `projectPath` if provided, else fall back to `config.defaultProject`\n\n3. **Callback flow**: `mouse:<project>:<task-id>` → look up project path → pass to spawnSession\n\n4. **Direct /mouse command**: Could auto-discover project by scanning all projects for the task ID","created_at":"2026-01-05T23:51:10.072546Z"},{"author":"anonymous","text":"## Simpler: Auto-discover project from task ID\n\nTask IDs are unique UUIDs across all projects. So:\n\n1. `/mouse <task-id>` (no change to command)\n2. Scan `PROJECTS_DIR/*/.ba/issues.jsonl` for matching task ID\n3. Return project path where task was found\n4. Pass to spawnSession\n\nAdd `findProjectForTask(taskId): string | null` to scanner.ts\n\nCallback data stays simple: `mouse:<task-id>` (no project needed)","created_at":"2026-01-05T23:52:15.970979Z"},{"author":"anonymous","text":"## Cleanup: Remove MIRANDA_DEFAULT_PROJECT\n\nWith auto-discovery, MIRANDA_DEFAULT_PROJECT is no longer needed:\n- Remove from config.ts\n- Remove from .env.example\n- Remove fallback in spawnSession\n- Error if task not found in any project\n\nThis simplifies setup - just set PROJECTS_DIR and it works.","created_at":"2026-01-05T23:52:31.990826Z"}],"created_at":"2026-01-05T10:24:02.508262Z","updated_at":"2026-01-06T00:02:59.550144224Z","closed_at":"2026-01-06T00:02:59.550144224Z","blocks":[],"blocked_by":[]}
{"id":"kv-fhu7","title":"Add /update command to pull all clean projects","description":"Pull latest changes for all projects via git pull --ff-only. Skip dirty repos and projects with active sessions. Report: updated (with commit count), skipped (dirty), skipped (active task), already current.","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-08T12:18:09.484911Z","updated_at":"2026-01-08T13:35:28.033390815Z","closed_at":"2026-01-08T13:35:28.033390815Z","blocks":[],"blocked_by":[]}
{"id":"kv-gevk","title":"Add /cleanup command - remove orphaned tmux sessions (mouse/drummer/notes sessions with no tracked state)","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T23:08:55.154215Z","updated_at":"2026-01-05T23:20:46.241654650Z","closed_at":"2026-01-05T23:20:46.241654650Z","blocks":[],"blocked_by":[]}
{"id":"kv-goq4","title":"Handle notification → inline keyboard - parse AskUserQuestion from hook, send Telegram message with inline buttons","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:15:48.107936Z","updated_at":"2026-01-05T10:38:51.111896Z","closed_at":"2026-01-05T10:38:51.111896Z","blocks":[],"blocked_by":[]}
{"id":"kv-gx77","title":"Implement hooks/server.ts - HTTP server on MIRANDA_PORT, POST /notify receives HookNotification, calls onNotification callback","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:39:08.621223Z","updated_at":"2026-01-05T10:50:49.956063Z","closed_at":"2026-01-05T10:50:49.956063Z","blocks":["kv-jncb"],"blocked_by":[]}
{"id":"kv-hc9h","title":"Add --base option to /mouse command","description":"Support /mouse <task-id> --base <branch> to pass base branch to mouse skill. Parse optional --base argument and include in skill invocation.","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-08T14:05:12.327716Z","updated_at":"2026-01-08T15:02:32.135662288Z","closed_at":"2026-01-08T15:02:32.135662288Z","blocks":[],"blocked_by":[]}
{"id":"kv-i9c4","title":"Create Claude Code plugin for mouse/drummer skills with marketplace distribution","description":"","status":"closed","priority":3,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Move mouse/drummer skills into miranda repo. Create plugin manifest for Claude Code marketplace. Auto-install/update via: claude plugin install miranda. Skills would live in plugin directory and be symlinked or copied to ~/.claude/skills/.","created_at":"2026-01-05T15:41:17.905957Z"}],"created_at":"2026-01-05T15:40:50.437194Z","updated_at":"2026-01-05T15:50:37.976998Z","closed_at":"2026-01-05T15:50:37.976998Z","blocks":[],"blocked_by":[]}
{"id":"kv-iqtq","title":"Server setup: Create systemd service for Miranda","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:19:35.337520Z","updated_at":"2026-01-05T11:43:20.342169Z","closed_at":"2026-01-05T11:43:20.342169Z","blocks":[],"blocked_by":[]}
{"id":"kv-j12y","title":"Update /stop command to accept fully qualified session names","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T23:02:36.191986Z","updated_at":"2026-01-05T23:16:47.516967191Z","closed_at":"2026-01-05T23:16:47.516967191Z","blocks":[],"blocked_by":[]}
{"id":"kv-j3me","title":"Server setup: Install and authenticate Claude CLI on Hetzner","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:19:35.327575Z","updated_at":"2026-01-05T12:48:10.474911Z","closed_at":"2026-01-05T12:48:10.474911Z","blocks":[],"blocked_by":[]}
{"id":"kv-jncb","title":"Wire index.ts - import all modules, connect bot commands to tmux/state, hook server to bot notifications, start both","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:39:14.701761Z","updated_at":"2026-01-05T12:04:13.856226Z","closed_at":"2026-01-05T12:04:13.856226Z","blocks":[],"blocked_by":["kv-0nas","kv-t4d1","kv-gx77","kv-cu1m","kv-duia","kv-ui80"]}
{"id":"kv-juh0","title":"Implement callback → tmux send-keys - when user taps inline button, inject response into Claude session","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:15:52.246124Z","updated_at":"2026-01-05T10:38:51.117015Z","closed_at":"2026-01-05T10:38:51.117015Z","blocks":[],"blocked_by":[]}
{"id":"kv-ld83","title":"Add MIRANDA_DEFAULT_PROJECT env var for working directory in tmux spawn","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Add to config.ts, pass to spawnSession(), use tmux -c flag. Update env.example too.","created_at":"2026-01-05T11:49:31.828828Z"}],"created_at":"2026-01-05T11:49:19.533517Z","updated_at":"2026-01-05T12:03:41.505119Z","closed_at":"2026-01-05T12:03:41.505119Z","blocks":[],"blocked_by":[]}
{"id":"kv-lqy3","title":"Sync command docs in README and /start message","description":"Ensure CLAUDE.md Commands table and bot /start help text list all implemented commands. Currently missing /update, /cleanup from some places. Keep both in sync as commands are added.","status":"open","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-08T14:06:13.555749Z","updated_at":"2026-01-08T14:06:13.555749Z","blocks":[],"blocked_by":[]}
{"id":"kv-n93y","title":"Escape markdown special characters in Telegram error messages","description":"Error messages passed to Telegram may contain backticks or other Markdown special chars (e.g., in stack traces). Add escaping helper or switch to HTML parse mode for error messages. Related to kv-658x.","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T16:47:06.493164079Z","updated_at":"2026-01-05T16:48:49.475420635Z","closed_at":"2026-01-05T16:48:49.475420635Z","blocks":[],"blocked_by":[]}
{"id":"kv-nfrg","title":"Implement /drummer command in Miranda - spawn drummer skill session","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T13:19:51.450618Z","updated_at":"2026-01-05T22:56:55.123448780Z","closed_at":"2026-01-05T22:56:55.123448780Z","blocks":[],"blocked_by":[]}
{"id":"kv-nixl","title":"Refactor session naming to be explicit about skill type with validation","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Current code infers skill from taskId presence (lines 53-68). Refactor to use skill parameter directly with proper validation. Use switch statement to make adding new skills explicit and catch unknown skills. Validate taskId required for mouse skill upfront rather than using non-null assertion.","created_at":"2026-01-05T16:12:34.402695Z"}],"created_at":"2026-01-05T16:11:45.836476Z","updated_at":"2026-01-05T22:57:17.530094563Z","closed_at":"2026-01-05T22:57:17.530094563Z","blocks":[],"blocked_by":[]}
{"id":"kv-o8q4","title":"Add completion signaling to mouse/drummer skills - curl Miranda /complete on success/error/blocked","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Add final step to mouse/drummer skills: curl to MIRANDA_PORT/complete with session=$TMUX_SESSION. Success sends PR URL, error sends reason, blocked sends blocker. Cover all exit paths. Depends on kv-658x (endpoint must exist first).","created_at":"2026-01-05T16:31:08.898105Z"},{"author":"anonymous","text":"Also add to /notes skill when created (kv-8r36). All three skills (mouse, drummer, notes) need completion signaling.","created_at":"2026-01-05T17:02:25.680055Z"},{"author":"anonymous","text":"Scope narrowed: this task is now mouse only. Drummer is kv-craa, notes is kv-qrkc.","created_at":"2026-01-05T17:06:40.333060Z"}],"created_at":"2026-01-05T16:30:55.707403Z","updated_at":"2026-01-05T22:57:34.017192709Z","closed_at":"2026-01-05T22:57:34.017192709Z","blocks":[],"blocked_by":["kv-658x"]}
{"id":"kv-qgnm","title":"Create bootstrap.sh - Claude setup script (skills, hooks, plugins)","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Plugin installations needed: claude plugin marketplace add cloud-atlas-ai/miranda && claude plugin install miranda@miranda; same pattern for sg (superego) and wm. All three plugins should be installed during bootstrap.","created_at":"2026-01-05T16:56:57.714967Z"}],"created_at":"2026-01-05T10:24:02.512608Z","updated_at":"2026-01-05T22:56:44.240915679Z","closed_at":"2026-01-05T22:56:44.240915679Z","blocks":[],"blocked_by":[]}
{"id":"kv-qrkc","title":"Add completion signaling to notes skill - curl /complete on success/error/blocked","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T17:02:32.480667Z","updated_at":"2026-01-05T22:58:20.040720291Z","closed_at":"2026-01-05T22:58:20.040720291Z","blocks":[],"blocked_by":["kv-658x","kv-8r36"]}
{"id":"kv-qvhi","title":"Add /newproject command - clone repo, init ba+sg+wm, support owner/repo and full URLs","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Accept owner/repo (GitHub) or full git URL. Clone to PROJECTS_DIR/<repo-name>. Run ba init, sg init, wm init. Error if dir exists. Assumes gh auth configured.","created_at":"2026-01-05T16:09:15.203798Z"}],"created_at":"2026-01-05T16:08:50.759481Z","updated_at":"2026-01-06T19:15:40.619321783Z","closed_at":"2026-01-06T19:15:40.619321783Z","blocks":[],"blocked_by":[]}
{"id":"kv-r5we","title":"Update bootstrap.sh to install plugins - miranda, superego, wm via marketplace","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Add to bootstrap.sh: claude plugin marketplace add cloud-atlas-ai/miranda && claude plugin install miranda@miranda. Same for superego and wm. Replaces manual skill copying with plugin-based distribution.","created_at":"2026-01-05T17:00:02.597058Z"}],"created_at":"2026-01-05T16:59:57.084293Z","updated_at":"2026-01-05T17:25:43.392226877Z","closed_at":"2026-01-05T17:25:43.392226877Z","blocks":[],"blocked_by":[]}
{"id":"kv-rgg2","title":"Harden path traversal protection - canonicalize and verify paths stay within projectsDir","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Current validation only checks for '/', '', '..' literals. Vulnerable to:\n- URL-encoded chars (%2e%2e)\n- Unicode normalization tricks\n- Symlink escapes\n\nFix: Use realpath canonicalization and verify containment:\n\n```typescript\nimport { realpath } from 'fs/promises';\n\nasync function isPathWithin(child: string, parent: string): Promise<boolean> {\n  const resolvedChild = await realpath(child);\n  const resolvedParent = await realpath(parent);\n  return resolvedChild.startsWith(resolvedParent + path.sep);\n}\n```\n\nApply in:\n- findProjectForTask()\n- getProjectTasks()\n- Any function that builds paths from user input","created_at":"2026-01-06T00:16:16.186216Z"}],"created_at":"2026-01-06T00:16:04.679519Z","updated_at":"2026-01-06T00:35:08.654588834Z","closed_at":"2026-01-06T00:35:08.654588834Z","blocks":[],"blocked_by":[]}
{"id":"kv-t4d1","title":"Implement tmux/sessions.ts - spawnSession(skill, taskId, chatId), killSession(tmuxName), sendKeys(tmuxName, text), listTmuxSessions()","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Spawn command: tmux new-session -d -s mouse-<taskId> \"claude '<skill> <taskId>' --dangerously-skip-permissions\"","created_at":"2026-01-05T10:43:54.046191Z"}],"created_at":"2026-01-05T10:39:08.615928Z","updated_at":"2026-01-05T10:53:23.574671Z","closed_at":"2026-01-05T10:53:23.574671Z","blocks":["kv-duia","kv-jncb"],"blocked_by":[]}
{"id":"kv-ui80","title":"Implement state/sessions.ts - Map-based session store with getSession, setSession, deleteSession, getAllSessions, findSessionByTmuxName, findSessionAwaitingInput","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:45:04.247060Z","updated_at":"2026-01-05T10:48:34.215368Z","closed_at":"2026-01-05T10:48:34.215368Z","blocks":["kv-duia","kv-jncb"],"blocked_by":[]}
{"id":"kv-w6yl","title":"/tasks command should use 'ba ready' instead of reading issues.jsonl directly","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Current: getProjectTasks() in scanner.ts reads .ba/issues.jsonl directly, shows all open+in_progress tasks. Change to: execFileAsync('ba', ['ready', '--json'], {cwd: projectPath}) - shows only unblocked tasks. Better UX: user sees what's actually workable, not blocked tasks. May need to handle ba ready output format (check ba ready --help for json output).","created_at":"2026-01-08T18:19:52.940885Z"}],"created_at":"2026-01-08T18:19:27.779582Z","updated_at":"2026-01-08T18:27:08.649363467Z","closed_at":"2026-01-08T18:27:08.649363467Z","blocks":[],"blocked_by":[]}
{"id":"kv-whsy","title":"Add completion signaling to mouse skill - signal Miranda BEFORE worktree cleanup","description":"","status":"in_progress","priority":2,"issue_type":"task","session_id":"2156039","labels":[],"comments":[{"author":"anonymous","text":"Mouse skill lacks Miranda completion signaling (notes skill has it). Current flow: cd to main → cleanup worktree → exit. Bug: Claude may still be in worktree when it deletes, breaking subsequent curl. Fix: Add completion signaling section like notes, order must be: 1) cd to original-dir 2) curl /complete 3) git worktree remove. This ensures signal succeeds even if cleanup fails.","created_at":"2026-01-08T18:00:52.354290Z"},{"author":"anonymous","text":"Approach: Option 1 - cd out of worktree first. The fix is to ensure mouse skill explicitly cd's back to main repo before cleanup and signaling. Order: 1) cd to main repo (git rev-parse --show-toplevel from before worktree creation, or use ORIGINAL_DIR saved at start) 2) git worktree remove (safe, not in it) 3) curl /complete (valid cwd) 4) session dies. Key: save ORIGINAL_DIR at skill start, use it at end.","created_at":"2026-01-08T18:04:19.714826Z"}],"created_at":"2026-01-08T18:00:44.669022Z","updated_at":"2026-01-08T18:23:18.387603537Z","blocks":[],"blocked_by":[]}
{"id":"kv-wjzx","title":"Drummer: require human approval before merging PRs","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T12:12:16.170802Z","updated_at":"2026-01-05T12:13:43.159312Z","closed_at":"2026-01-05T12:13:43.159312Z","blocks":[],"blocked_by":[]}
{"id":"kv-xxld","title":"Implement tmux session spawning - /mouse command spawns tmux session running claude /mouse <task-id>","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-05T10:15:33.333723Z","updated_at":"2026-01-05T10:38:51.102258Z","closed_at":"2026-01-05T10:38:51.102258Z","blocks":[],"blocked_by":[]}
{"id":"kv-yk15","title":"Wire /notes command in Miranda bot - spawn notes skill session with PR number","description":"","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[{"author":"anonymous","text":"Add bot.command('notes', handleNotes) in commands.ts. handleNotes takes PR number (not task ID), validates it's numeric, calls spawnSession('notes', prNumber, chatId). Similar pattern to mouse/drummer. Update help text.","created_at":"2026-01-05T17:16:26.070026Z"}],"created_at":"2026-01-05T17:16:18.051383Z","updated_at":"2026-01-05T22:58:30.867997718Z","closed_at":"2026-01-05T22:58:30.867997718Z","blocks":[],"blocked_by":["kv-8r36"]}
{"id":"kv-yx70","title":"Require explicit project for /drummer command","description":"Change /drummer to require project argument: /drummer <project>. Validate project exists in PROJECTS_DIR, pass projectPath to spawnSession. Error if no project specified.","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-08T14:18:32.219039Z","updated_at":"2026-01-08T17:38:54.042412Z","closed_at":"2026-01-08T15:01:26.306709211Z","blocks":["kv-zozr"],"blocked_by":[]}
{"id":"kv-zozr","title":"Prefix drummer/notes tmux sessions with project name","description":"Change session naming from 'drummer-<timestamp>' to '<project>-drummer-<timestamp>' and 'notes-<pr>' to '<project>-notes-<pr>'. Helps identify which project a session belongs to in /status and tmux ls. Depends on explicit project args being added first.","status":"closed","priority":2,"issue_type":"task","labels":[],"comments":[],"created_at":"2026-01-08T17:38:49.934894Z","updated_at":"2026-01-08T17:47:59.258635217Z","closed_at":"2026-01-08T17:47:59.258635217Z","blocks":[],"blocked_by":["kv-yx70","kv-73n6"]}
